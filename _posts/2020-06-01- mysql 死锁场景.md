---
layout:     post
title:      MySQL 常见的死锁场景
subtitle:   MySQL 常见的死锁场景
date:       2020-06-01
author:     ZW
header-img: img/mysql_img.jpg
catalog: 	 true
tags:
    - MySQL
---

# 间隙锁
[图一](/img/2020_06_01__01.png)

1. session A 执行 select … for update 语句，由于 id=9 这一行并不存在，因此会加上间隙锁 (5,10);
2. session B 执行 select … for update 语句，同样会加上间隙锁 (5,10)，间隙锁之间不会冲突，因此这个语句可以执行成功；
3. session B 试图插入一行 (9,9,9)，被 session A 的间隙锁挡住了，只好进入等待；
4. session A 试图插入一行 (9,9,9)，被 session B 的间隙锁挡住了。

至此，两个 session 进入互相等待状态，形成死锁。当然，InnoDB 的死锁检测马上就发现了这对死锁关系，让 session A 的 insert 语句报错返回了。

参考 丁奇 ·《MySQL实战45讲》
    
参考 《高性能MySQL》

