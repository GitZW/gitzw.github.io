---
layout:     post
title:      NGINX 学习笔记（三）
subtitle:   NGINX 学习笔记（三）
date:       2020-11-25
author:     ZW
header-img: img/mysql_img.jpg
catalog: 	 true
tags:
    - NGINX
---

# 指令合并
* 值指令可以合并 root,gzip,access_log 等
* 动作指令不可以合并 proxy_pass,rewrite等
## 合并规则
* 子配置不存在时，直接使用父模块
* 子配置存在时，覆盖父模块配置


# listen 指令 示例
![图一](/img/20201125065054.jpg)

# server_name 指令
* 指令后跟多个域名
* 泛域名
* 正则表达式 （可创建变量）

## 匹配顺序
1. 精准匹配
2. *在前的泛域名
3. *在后的泛域名
4. 按文件中的顺序匹配正则表达式
5. default 值

# http 请求11个阶段


# 如何拿到用户的真实ip
由于网络中存在许多反向代理，所以无法从tcp四元组中获得
http头 X-Forwarded-For 用于传递ip 可以为数组
http头 X-Real-IP 用于传递用户ip 单个值

# rewrite 模块
## return 指令 与 error_page
```
Syntax:	return code [text];
return code URL;
return URL;
Default:	—
Context:	server, location, if
```

```
Syntax:	error_page code ... [=[response]] uri;
Default:	—
Context:	http, server, location, if in location
```

## rewrite 指令
```
Syntax:	rewrite regex replacement [flag];
Default:	—
Context:	server, location, if

An optional flag parameter can be one of:

last
stops processing the current set of ngx_http_rewrite_module directives and starts a search for a new location matching the changed URI;
break
stops processing the current set of ngx_http_rewrite_module directives as with the break directive;
redirect
returns a temporary redirect with the 302 code; used if a replacement string does not start with “http://”, “https://”, or “$scheme”;
permanent
returns a permanent redirect with the 301 code.
```
rewrite_log on | off; 打开重定向日志




