---
layout:     post
title:      NGINX 学习笔记（四）
subtitle:   NGINX 学习笔记（四）
date:       2020-12-20
author:     ZW
header-img: img/mysql_img.jpg
catalog: 	 true
tags:
    - NGINX
---

# round-robin 算法
```
Syntax:	upstream name { ... }
Default:	—
Context:	http

Syntax:	server address [parameters];
Default:	—
Context:	upstream
```
ex:
```
upstream backend {
    server backend1.example.com weight=5;
    server 127.0.0.1:8080       max_fails=3 fail_timeout=30s;
    server unix:/tmp/backend3;
    server backup1.example.com  backup;
}
```

* round-robin加权轮训的方式访问server指令中的上游服务

# 对上游使用keep-alive
```
proxy_http_version 1.1;    
proxy_set_header Connection "";
```


# ip_hash 与hash
```shell script
upstream h5 {
   ip_hash;
   server 192.168.100.104:9080;
   server 192.168.100.105:9080;
 }
```
ip_hash ipv4 使用前3个字节，ipv6 使用全部字节

```
Syntax:	hash key [consistent];
Default:	—
Context:	upstream
```
可以使用一致性hash算法

