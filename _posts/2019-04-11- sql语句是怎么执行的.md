---
layout:     post
title:      MySQL 一条sql语句是怎么执行的
subtitle:   sql 语句是怎么执行的
date:       2019-04-11
author:     ZW
header-img: img/mysql_img.jpg
catalog: 	 true
tags:
    - MySQL
---

# 查询语句怎么执行的
![查询语句怎么流程](/img/20190411_01.jpg)

## 连接器
MySQL服务器和MySQL客户端连接使用tcp协议。如果认证通过，连接器会到权限表中查出账号拥有的权限，以后所有的权限判断都是基于此时查出的权限。也就是说用户连接成功后，在修改用户权限，是对已成功的连接不会成效的。

连接建立成功后，如果长时间没有操作，连接器会自动断开连接。断开连接的时间是由wait_timeout控制的，默认值是8小时。

## 查询缓存
MySQL查询缓存保存查询返回的完整结构。当查询命中该缓存时，MySQL会立刻返回结果，跳过了解析、优化和执行阶段。  查询缓存系统会跟踪查询中涉及的每个表，如果这些表发生了变化，那么和这个表相关的所有缓存数据都将失效。

当查询语句中有一些不确定的数据时，则不会被缓存。例如包含函数NOW()或者CURRENT_DATE()的查询不会缓存。包含任何用户自定义函数，存储函数，用户变量，临时表，mysql数据库中的系统表或者包含任何列级别权限的表，都不会被缓存。


## 分析器
对 SQL 语句做解析，词法分析出"select" ,要使用的表名，字段等等。语法分析，看sql语句是否满足mysql 的语法。


##优化器
决定使用哪个索引，怎么join表等等，生成执行计划

## 执行器
开始执行的时候，要先判断一下你对这个表 T 有没有执行查询的权限，如果没有，就会返回没有权限的错误。如果有权限，就打开表继续执行。打开表的时候，执行器就会根据表的引擎定义，去使用这个引擎提供的接口。

# 更新语句怎么执行的





参考 丁奇 ·《MySQL实战45讲》    
参考 《高性能MySQL》
